name: CI/CD Workflow for walt.id XYZ Kit

on:
  push:
    branches:
      - name: 2-trigger-release-on-pr-mergeclose
      # https://developer.github.com/v3/repos/branches/#update-branch-protection
      # Branch Protection settings. Set to null to disable
        protection:
          # Required. Require at least one approving review on a pull request, before merging. Set to null to disable.
          required_pull_request_reviews:
            # The number of approvals required. (1-6)
            required_approving_review_count: 1
            # Dismiss approved reviews automatically when a new commit is pushed.
            dismiss_stale_reviews: true
          required_status_checks: null
          restrictions: null
          enforce_admins: null
  pull_request:
    branches:
      - main

jobs:
  verify-wrapper:
    name: "Verification"
    runs-on: "ubuntu-latest"
    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Validate gradle wrapper
        uses: gradle/wrapper-validation-action@v1

  gradle:
    needs: verify-wrapper
    name: "Build"
    strategy:
      matrix:
        # os: [ubuntu-latest, macos-latest]
        os: [ubuntu-latest]
    runs-on: ${{ matrix.os }}
    steps:
    - name: Checkout code
      uses: actions/checkout@v2
    - name: Setup java
      uses: actions/setup-java@v2.1.0
      with:
        distribution: 'adopt-hotspot'
        java-version: '16'
    - name: Running gradle build
      uses: eskatos/gradle-command-action@v1.3.3
      with:
        arguments: build --no-daemon --info
